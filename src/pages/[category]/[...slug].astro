---
import { getCollection, render } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import Footer from '@/components/Footer.astro';
import FormattedDate from '@/components/FormattedDate.astro';
import Image from '@/components/Image.astro';
import "@/styles/layouts/blog-post.scss"
import { ArrowLeftIcon } from '@heroicons/react/24/solid';
import { Header } from '@/components/Header';
import { categories, getCategoryKeys, type CategoryKey } from '@/lib/categories';

export async function getStaticPaths() {
	const categoryKeys = getCategoryKeys();
	const paths = [];

	for (const key of categoryKeys) {
		const config = categories[key];
		const posts = await getCollection(config.collection);
		for (const post of posts) {
			paths.push({
				params: { category: key, slug: post.id },
				props: { post, category: key },
			});
		}
	}

	return paths;
}

const { post, category } = Astro.props;
const config = categories[category as CategoryKey];
const { Content } = await render(post);
---

<BaseLayout title={post.data.title} description={post.data.description}>
	<Header client:load />
	<main class="max-w-full mx-5 my-10">
		<div class="max-w-[1024px] mx-auto sm:p-4">
			<a href={`/${category}`} class="inline-flex items-center min-h-[38px] font-rubik text-sm text-gray-600 md:mx-10 mb-2 md:mb-4 hover:underline">
				<ArrowLeftIcon className="w-4 h-4 mr-2" />
				{config.label}
			</a>
			<div class="mb-8 leading-none md:mx-10">
				{(post.data.draft || post.data.examplePage || (post.data.tags && post.data.tags.length > 0)) && (
					<div class="flex gap-2 mb-7">
						{post.data.draft && (
							<span class="inline-flex items-center rounded-full font-rubik bg-amber-500 px-3 py-1.5 text-sm font-medium text-white">
								Draft
							</span>
						)}
						{post.data.examplePage && (
							<span class="inline-flex items-center rounded-full bg-purple-500 px-3 py-1.5 text-sm font-medium text-white">
								Example
							</span>
						)}
						{((post.data.draft || post.data.examplePage) && (post.data.tags && post.data.tags.length > 0)) && (
							<span class="border-l-2 pl-1 ml-1"></span>
						)}
						{post.data.tags.map((tag) => (
							<span class="inline-flex items-center font-rubik text-sm rounded-full text-orange-600 px-4 py-1.5 border border-orange-500">
								{tag}
							</span>
						))}
					</div>
				)}
				<h1 class="text-4xl lg:text-5xl font-rajdhani font-bold">
					{post.data.title}
				</h1>
				<div class="inline-flex items-center gap-3 text-lg text-zinc-600 mt-7 lg:mt-10 font-rubik">
					<span>
						Posted on <FormattedDate class='text-orange-700' date={post.data.pubDate} />
					</span>
					{post.data.updatedDate && (
						<span class="bg-transparent border-2 border-orange-600 rounded-full flex-none h-2 w-2" />
						<span>
							Updated on <FormattedDate class='text-orange-700' date={post.data.updatedDate} />
						</span>
					)}
				</div>
				<p class="text-lg leading-8 mt-4 lg:mt-7 text-zinc-500 font-rubik">
					{post.data.description}
				</p>
			</div>
			<div class="w-full mb-6">
				{post.data.heroImage && (
					<Image class="rounded-2xl"
							src={post.data.heroImage}
							alt={post.data.heroImageAlt ?? ''} />
				)}
			</div>
			<article class="blog-content">
				<Content />
			</article>
		</div>
	</main>
	<Footer />
</BaseLayout>
